(function(t){function e(e){for(var a,i,o=e[0],c=e[1],l=e[2],d=0,f=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(f.length)f.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(s.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},r={app:0},s=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/gantt/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"569e":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[t.isInit?t._e():n("preloader"),t.errorText?n("div",[t._v("\n        "+t._s(t.errorText)+"\n    ")]):n("div",[t._l(t.statesScale,(function(e,a){return n("button",{key:a,attrs:{id:e.id,type:"button",disabled:t.stateScale===e.id},on:{click:function(n){return t.setScaleConfig(e.id)}}},[t._v("\n            "+t._s(e.text)+"\n        ")])})),t.changes.length>0?n("div",[n("button",{attrs:{type:"button"},on:{click:function(e){return t.checkTaskChangesFromServer(t.changes)}}},[t._v("\n                Сохранить\n            ")]),n("button",{attrs:{type:"button"},on:{click:function(e){return t.cancelEdit()}}},[t._v("\n                Отменить\n            ")])]):t._e(),n("div",{ref:"gantt",staticClass:"gantt",class:"gantt--"+t.stateScale})],2)],1)},s=[],i=(n("7514"),n("5df3"),n("1c4c"),n("ac6a"),n("96cf"),n("3b8d")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"preloader"},[n("svg",{staticStyle:{"enable-background":"new 0 0 50 50"},attrs:{id:"Layer_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"24px",height:"30px",viewBox:"0 0 24 30","xml:space":"preserve"}},[n("rect",{attrs:{x:"0",y:"13",width:"4",height:"5",fill:"#3db9d3"}},[n("animate",{attrs:{attributeName:"height",attributeType:"XML",values:"5;21;5",begin:"0s",dur:"0.6s",repeatCount:"indefinite"}}),n("animate",{attrs:{attributeName:"y",attributeType:"XML",values:"13; 5; 13",begin:"0s",dur:"0.6s",repeatCount:"indefinite"}})]),n("rect",{attrs:{x:"10",y:"13",width:"4",height:"5",fill:"#3db9d3"}},[n("animate",{attrs:{attributeName:"height",attributeType:"XML",values:"5;21;5",begin:"0.15s",dur:"0.6s",repeatCount:"indefinite"}}),n("animate",{attrs:{attributeName:"y",attributeType:"XML",values:"13; 5; 13",begin:"0.15s",dur:"0.6s",repeatCount:"indefinite"}})]),n("rect",{attrs:{x:"20",y:"13",width:"4",height:"5",fill:"#3db9d3"}},[n("animate",{attrs:{attributeName:"height",attributeType:"XML",values:"5;21;5",begin:"0.3s",dur:"0.6s",repeatCount:"indefinite"}}),n("animate",{attrs:{attributeName:"y",attributeType:"XML",values:"13; 5; 13",begin:"0.3s",dur:"0.6s",repeatCount:"indefinite"}})])])])},c=[],l=n("2877"),u={},d=Object(l["a"])(u,o,c,!1,null,null,null),f=d.exports,g=n("bc3a"),h=n.n(g),p=function(t){return{res:null,err:t}},v=function(t){return{res:t,err:null}},y="/gantt",_=function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h.a.get("".concat(y,"/get/data.json"));case 3:if(e=t.sent,n=e.data,!n.err){t.next=7;break}throw n;case 7:return t.abrupt("return",v(n));case 10:throw t.prev=10,t.t0=t["catch"](0),console.error(t.t0),p(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}(),k=(n("28a5"),n("768b")),m=function(t){var e=t.toLocaleString("ru").substring(0,10).split("."),n=Object(k["a"])(e,3),a=n[0],r=n[1],s=n[2];return[a,r,s]},b=function(t){var e=m(t),n=Object(k["a"])(e,3),a=n[0],r=n[1],s=n[2];return"".concat(a,"-").concat(r,"-").concat(s)},w=function(t){var e=t.split("-"),n=Object(k["a"])(e,3),a=n[0],r=n[1],s=n[2];return new Date(s,+r-1,a)},x=function(t){return Math.floor(100*t)/100},C=function(t){return x(t/60)},S=function(t,e){return t.classList.add(e)},T=function(t,e){t=t.getDay();var n="day";return e!==n||0!==t&&6!==t?"gantt__workday":"gantt__weekend"},D=n("6bfb"),O={name:"App",components:{preloader:f},data:function(){return{gantt:D["gantt"],errorText:"",tasks:{data:null},statesScale:[{text:"День",id:"day"},{text:"Неделя",id:"week"},{text:"Месяц",id:"month"}],stateScale:"day",isLoading:!1,changes:[]}},computed:{isInit:function(){return(this.tasks.data||this.errorText)&&!this.isLoading}},mounted:function(){this.getTasksData()},methods:{initGantt:function(t){var e=this.tasks;e.data=t.tasks,e.readonly=t.readonly,e.startDate=t.start_date,e.endDate=t.end_date,this.setLayoutConfig(),D["gantt"].init(this.$refs.gantt),D["gantt"].parse(this.tasks),this.afterTaskDragProcessing(),this.setMonthWeekWorkload()},getTasksData:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,_();case 2:e=t.sent,n=e.res,a=e.err,n?this.initGantt(n):(console.error(a),this.errorText=a.text||"Неизвестная ошибка");case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),afterTaskDragProcessing:function(){var t=this;D["gantt"].attachEvent("onAfterTaskDrag",(function(e,n,a){var r=D["gantt"].getTask(e),s={id:e,start_date:b(r.start_date),end_date:b(r.end_date)};t.checkTaskChangesFromServer(s)}))},checkTaskChangesFromServer:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.setIsLoading(),t.next=3,_();case 3:n=t.sent,a=n.res,r=n.err,a?(this.changes=[],this.refreshTasksData(a.tasks),this.createHttpResMessage(!0),this.setIsLoading()):(console.error(r),this.changes=[],D["gantt"].undo(),this.createHttpResMessage(!1),D["gantt"].refreshData(),this.setIsLoading());case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),refreshTasksData:function(t){t.forEach((function(t){var e=D["gantt"].getTask(t.id);t.type===D["gantt"].config.types.task&&(e.start_date&&(e.start_date=w(t.start_date)),e.end_date&&(e.end_date=w(t.end_date))),e.loads=t.loads})),D["gantt"].refreshData()},setIsLoading:function(){this.isLoading=!this.isLoading},createHttpResMessage:function(t){D["gantt"].message({type:t?"success":"error",text:t?"Сохранено":"Данные изменения не возможны",expire:5e3})},setLayoutConfig:function(){D["gantt"].config.layout={css:"gantt_container",config:this.setGanttCommonConfig(),rows:[{cols:[{view:"scrollbar",id:"scrollVer"},{width:500,min_width:300,config:this.setColumnsConfig(),rows:[{view:"grid",scrollX:"scrollHor",scrollY:"scrollVer",config:this.setTasksConfig()}]},{rows:[{view:"timeline",scrollX:"scrollHor",scrollY:"scrollVer",config:this.setScaleDay()},{view:"scrollbar",id:"scrollHor"}]}]}]}},setGanttCommonConfig:function(){var t=D["gantt"].config;t.undo_steps=1,t.details_on_dblclick=!1;var e=D["gantt"].addMarker({start_date:new Date,css:"today"});D["gantt"].getMarker(e),t.start_date=w(this.tasks.startDate),t.end_date=w(this.tasks.endDate)},setTasksConfig:function(){var t=this,e=D["gantt"].config,n=D["gantt"].templates;e.types.user="user",e.fit_tasks=!0,e.duration_unit="week",e.duration_step=1,n.task_class=function(t,n,a){return a.type=e.types[a.type],a.type===e.types.user?"gantt__user-scale":a.type===e.types.project?"gantt__project-scale":"gantt__task-scale"},n.leftside_text=function(t,e,n){if(n.time&&n.time_used)return"(".concat(C(n.time)," - ").concat(C(n.time_used),")")},D["gantt"].templates.scale_cell_class=function(e){return T(e,t.stateScale)},n.timeline_cell_class=function(e,n){return"".concat(T(n,t.stateScale)," ").concat(b(n))},this.setDayWorkLoadCell()},setDayWorkLoadCell:function(){var t=this;D["gantt"].templates.task_text=function(e,n,a){var r=t.tasks.readonly||a.type!==D["gantt"].config.types.task;return"day"===t.stateScale?a.loads.day.map((function(t){var e="",n=C(t.time);return n>7?e="error":7===n&&(e="success"),r?'<div class="gantt__load-cell '.concat(e,'"\n                                >\n                                    ').concat(n||"","\n                                </div>"):'<input task_cell_id="'.concat(a.id,'"\n                                    date="').concat(t.date,'"\n                                    value="').concat(n||"",'" \n                                    readonly\n                                    class="js-workload gantt__load-cell ').concat(e,'"\n                                >')})).join(""):""}},setMonthWeekWorkload:function(){var t=this;D["gantt"].attachEvent("onTaskClick",(function(e){return t.editWorkload(e),t.setReadOnlyWorkloadCell(),!0}))},editWorkload:function(t){var e=this;if("day"===this.stateScale){var n=this.$el.querySelectorAll('[task_cell_id="'.concat(t,'"]'));Array.from(n).forEach((function(n){n.oninput=function(a){a.preventDefault();var r=n.value.trim(),s=/[0-9]$/.test(r)||""===r;if(s){var i=n.getAttribute("date"),o=e.changes.find((function(e){if(e.id===t&&e.date===i)return e.load=r,e}));o||e.changes.push({id:t,date:i,load:r})}else n.value=""},n.ondblclick=function(t){return t.target.removeAttribute("readonly")},n.onblur=function(t){return t.target.setAttribute("readonly",!0)}}))}},setReadOnlyWorkloadCell:function(){var t=this;if("day"!==this.stateScale){var e=this.$el.querySelectorAll("[task_id]");Array.from(e).forEach((function(e){var n=e.getAttribute("task_id"),a=D["gantt"].getTask(n),r=a.loads[t.stateScale];r.forEach((function(n){var a=e.getElementsByClassName(n.date);if(a.length>0&&n.time){var r="normal",s=C(n.time);"week"===t.stateScale?s>35?r="error":35===s&&(r="success"):"month"===t.stateScale&&(s>170?r="error":170===s&&(r="success")),s&&(a[0].textContent=s,S(a[0],r))}}))}))}},setColumnsConfig:function(){D["gantt"].config.columns=[{name:"text",label:"Тема",width:400,tree:!0,template:function(t){return'<a  href="'.concat(t.url,'">').concat(t.text,"</a> ")}},{name:"priority",label:"Приоритет",align:"center",width:100,template:function(t){return t.priority||""}}]},setScaleConfig:function(t){switch(D["gantt"].config.smart_scales=!0,this.stateScale=t,t){case"day":this.setScaleDay(),D["gantt"].render();break;case"week":this.setScaleWeek(),this.setReadOnlyWorkloadCell();break;case"month":this.setScaleMonth(),this.setReadOnlyWorkloadCell();break}},setScaleDay:function(){var t=D["gantt"].config;t.scale_unit="day",t.step=1,t.date_scale="%d",t.subscales=[{unit:"month",step:1,date:"%F, %Y"}],t.scale_height=60,t.readonly=this.tasks.readonly},setScaleWeek:function(){var t=D["gantt"].config;t.scale_unit="month",t.date_scale="%F, %Y",t.scale_height=60,t.subscales=[{unit:"week",step:1,date:"%W"}],D["gantt"].templates.date_scale=null,t.readonly=!0,D["gantt"].render()},setScaleMonth:function(){var t=D["gantt"].config;t.scale_unit="year",t.date_scale="%Y",t.scale_height=60,t.subscales=[{unit:"month",step:1,date:"%M"}],D["gantt"].templates.date_scale=null,t.readonly=!0,D["gantt"].render()},cancelEdit:function(){D["gantt"].refreshData(),this.changes=[]}}},j=O,L=Object(l["a"])(j,r,s,!1,null,null,null),M=L.exports;n("f44c"),n("569e"),n("3d5a"),n("4df3"),n("987c");a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(M)}}).$mount("#app")}});
//# sourceMappingURL=app.5a91f20f.js.map